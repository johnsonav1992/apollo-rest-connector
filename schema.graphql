# This schema uses Apollo Connectors, a declarative programming model for
# GraphQL that allows you to plug in your existing REST services directly into
# a graph. To learn more, visit Apollo's documentation: ðŸ”—https://www.apollographql.com/docs/graphos/schema-design/connectors

# Guided tutorial: ðŸ”— https://www.apollographql.com/docs/graphos/get-started/guides/rest

extend schema
  @link( # Enable this schema to use Apollo Federation features
    url: "https://specs.apollo.dev/federation/v2.11"
  )
  @link( # Enable this schema to use Apollo Connectors
    url: "https://specs.apollo.dev/connect/v0.2"
    import: ["@connect", "@source"]
  )

# âœï¸ This schema is using a demo REST API as its @source. Replace the `name` and `baseURL` of it with your own REST API.
@source(
  name: "ecomm"
  # A @source directive defines a shared data source for multiple Connectors.
  http: {
    baseURL: "https://ecommerce.demo-api.apollo.dev/"
    headers: [
      # Map X-Ecomm-Token from client to Authorization header for ecomm API
      { name: "Authorization", from: "x-ecomm-token" }
    ]
  }
)

# JSONPlaceholder API source
@source(
  name: "jsonplaceholder"
  http: {
    baseURL: "https://jsonplaceholder.typicode.com"
    headers: [
      # Map X-JSONPlaceholder-Token from client to Authorization header for jsonplaceholder API
      { name: "Authorization", from: "x-jsonplaceholder-token" }
    ]
  }
)

# âœï¸ Replace this example type with your own object type.
type Product {
  id: ID!
  name: String
  description: String
  slug: String
  primaryTag: String
}

# Post type from JSONPlaceholder API
type Post {
  id: ID!
  userId: Int
  title: String
  body: String
}

# âœï¸ Set up your Query field with the endpoint that returns the data you want.

type Query {
  # The Query.products field uses @connect to connect to the /products endpoint in the "ecomm" source.
  # To check out the JSON response for this endpoint, go to ðŸ”— https://ecommerce.demo-api.apollo.dev/products.
  products: [Product]
    # A @connect directive defines the API data source of a GraphQL schema field.
    @connect(
      source: "ecomm"
      http: { GET: "/products" } # GET, POST, PUT, PATCH, DELETE.
      # Use @connect for any field that should be resolved by your REST API endpoints.
      # Use the selection argument to map fields from the JSON response to the type.
      # You can do more with this selection mapping. Learn more at ðŸ”— https://www.apollographql.com/docs/graphos/schema-design/connectors/responses
      selection: """
      $.products {
        id
        name
        description
        slug
        primaryTag: tags->first.name
      }
      """
    )

  # Fetch all posts from JSONPlaceholder API
  posts: [Post]
    @connect(
      source: "jsonplaceholder"
      http: { GET: "/posts" }
      selection: """
      $ {
        id
        userId
        title
        body
      }
      """
    )

  # Fetch a single post by ID
  post(id: ID!): Post
    @connect(
      source: "jsonplaceholder"
      http: { GET: "/posts/{$args.id}" }
      selection: """
      $ {
        id
        userId
        title
        body
      }
      """
    )
}
